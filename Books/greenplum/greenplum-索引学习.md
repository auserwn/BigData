## Hash索引

### hash索引的介绍

底层是由hash表来实现的，是根据键值对<key,value>存储数据的结构

hash索引只需要做一次运算，即可找到数据所在的桶(桶bucket是指一个能存储一个或者多个记录的存储单元，桶中的每个元素都会指向下一行，形成一个链表。)，不像树结构那样从根-叶子节点的顺序来查找，hash索引的效率理论上是优于b树索引的。

适合根据key值查找value值，就是单个key的查询，或者说是等值查询

hash索引在并发的情况下表现不佳，不支持postgres的事务日志

![](E:\study\greenplum\greenplum-索引\p-hash索引.png)

hash索引是将字段值转换为32位的hash值，适用于大字段场景

### hash索引的优点

- 索引本身只存储对应的Hash值，索引结构紧凑，只需要做等值比较查询，而不包含排序或者范围查询的需求，适合使用hash索引
- 没有hash冲突的情况下，等职查询访问哈希索引的数据非常快
- 等值查询时，理论上时间复杂度为o(1)

### hash索引的缺点

- hash索引只包含哈希值和行指针，不存储字段值，所以不能使用索引中的值来避免读取行。
- hash索引只支持等值比较查询 (= 或者 in)，不支持任何范围查询和部分索引列匹配查找。[select * from aa where id between 100 and 500; 是不行的]-不能使用组合索引【如果创建的hash索引为a,b 不能只使用一个字段】
- hash索引并不是按照索引值顺序存储的，也就无法用于排序。
- 不支持模糊查询及多列索引的最左前缀匹配
- 不能避免表扫描，有时需要全表扫描。
- 如果hash冲突较多，效率通常不如B树
- hash索引通常比btree索引大一点。更占用空间。
- 不稳定，不可预测。如果查询某个键值存在大量重复发生哈希冲突，效率可能极差。不如btree稳定

### hash索引的应用场景

hash索引主要是在**memory引擎中**使用的

等值查询时常用或者对于内存中热点数据的处理。



## B树索引

### B-tree索引的介绍

对比二叉树：都是平衡树。但是B树中的每个节点中都存储大量键值，即树不会太高。

B树：节点中存储若干键值，节点有序排列。节点中的键值指向目标数据(key->data)

B+树：叶子节点存储了全部键值key，这些键值再指向目标数据。内部节点中重复存储了部份键值，但是不含数据指针。叶子节点层有一条正向遍历链表。

![](E:\study\greenplum\greenplum-索引\p-B树.png)



B+树非常适用数据库中的索引结构：减少磁盘IO，每个节点对应磁盘中的一个页，访问节点对应一次磁盘IO

为什么使用B+树而不是使用B树呢？第一：因为一次访问对应磁盘中一个页，即一次IO，B树中每个节点存储(key->data)，而B+树不需要存储数据，每个节点中存储的键值就多，故B+树的高度相对B树高度就会低，对应磁盘IO次数就会变少，从而提升性能。 第二：需要范围查找，叶子节点有正向指针。

### B-link树

greenplum中使用B树还是B+树呢？都不是，而是B-link树。就像oceanbase使用的是LMS-tree一样。总得有自己的创新。

![](E:\study\greenplum\greenplum-索引\p-Blink树.png)

![](E:\study\greenplum\greenplum-索引\p-Blink树逻辑结构.png)





### B-tree索引的优点

### B-tree索引的缺点

### B-tree索引的应用场景

## Bitmap索引

### Bitmap索引的介绍

Bitmap索引-位图索引，它将每个数据对象表示为一个位图，其中每个位表示一个属性值是否存在或者满足某个条件，从而实现快速的数据查找和访问。

Bitmap索引适用于具有低基数（cardinality）的属性，即属性值较少且重复率较高的属性。例如，性别、婚姻状况等属性就是低基数属性，它们的取值较少且重复率较高，适合采用Bitmap索引进行索引。



![](E:\study\greenplum\greenplum-索引\p-bitmap索引1.png)

执行过程

![](E:\study\greenplum\greenplum-索引\p-bitmap索引2.png)

![](E:\study\greenplum\greenplum-索引\p-bitmap索引3.png)



### Bitmap索引的优点

- 索引大小小，适用于低基数属性的索引；
- 支持快速的位图操作，可以快速实现数据的查询和过滤；
- 支持高效的范围查询，可以提高查询性能。
- 位图本质是数组，它是基于String数据类型的按位的操作。该数组由多个二进制位组成，每个二进制位都对应一个偏移量(我们可以称之为一个索引或者位格)。Bitmap支持的最大位数是2^32位，它可以极大的节约存储空间，使用512M内存就可以存储多大42.9亿的字节信息(2^32 = 4294967296)

- Bitmap索引的实现对于高基数属性不适用，因为位图的大小会随着属性值的增加而增加。
- Bitmap索引是为数仓(查询环境建立的)，特别不适合OLTP系统，不适合DML操作频繁的环境。会严重影响并发性
- update索引列的值的时候，会锁定新值和旧值指向的数据行，使用Bitmap索引需要慎重考虑锁表问题。！--做update代价非常高！
- 对列做位图索引(Bitmap)，该列必须是不常改动的。因为oracle在查询位图索引时，会将查找的某一重复值都锁定，在一个sql未提交前，其他用户操作拥有该重复值的sql会处于阻塞状态，直至第一个sql被提交。由于用位图反映数据,不同会话更新相同键值的同一位图段,insert、update、delete相互操作都会发锁定。

### Bitmap索引的应用场景

- 做update代价非常高
- 基数少的列(即重复值多)-建在值重复度高的列上，GP手册建议在100到100,000之间，如：职业、地市等。
- 特定类型的查询例如count、or、and等逻辑操作因为只需要进行位运算。如：通过多个条件组合查询，select count(*) from table where city = ’南京市’ and job = ’医生’ and phonetype = ‘iphone’ and gender =’男’。类似这种场景，如果在每个查询条件列上都建立了bitmap索引，则数据库可以进行高效的bit运算，精确定位到需要的数据，减少磁盘IO。并且筛选出的结果集越小，bitmap索引的优势越明显。
- 适用于即席查询、多维分析等OLAP场景。如果有一张表有100列，用户会使用其中的20 个列作为查询条件（任意使用这20个列上的N的列），几乎没有办法创建合适的 b-tree 索引。但是在这些列上创建 20 个 bitmap 索引，那么所有的查询都可以应用到索引。
- create bitmap index lie_bit_idx1 on table(liename);
- postgres中CREATE INDEX wsb_bit_index1 ON wn_study_bitmap USING bitmap (sex);

## Gin索引

### Gin索引的介绍

通用倒排索引-GIN索引  多值列

储存被索引字段的VALUE或者VALUE元素，类似图书末尾的索引，对于每个术语，列出出现该术语的页面列表

支持多值类型

### Gin索引的优点

### Gin索引的缺点

### Gin索引的应用场景

- 全文检索

## Gist索引

### Gist索引的介绍

Gist = Generalized search tree 通用搜索树

和btree一样，也是平衡的搜索树。和btree不同的是，btree索引常常用来进行例如大于、小于、等于这些操作中，而在实际生活中很多数据其实不适用这种场景，例如地理数据、图像等等。如果我们想要查询在某个地方是否存在某一点，即判断地理位置的"包含"那么我们就可以使用gist索引了。
因为gist索引允许定义规则来将任意类型的数据分布到一个平衡的树中，并且允许定义一个方法使用此表示形式来让某些运算符访问。例如，对于空间数据，GiST索引可以使用 R树，以支持相对位置运算符（位于左侧，右侧，包含等），而对于树形图，R树可以支持相交或包含运算符。

或者叫归纳树，用于解决一些b-tree, gin难以解决的数据减少问题，例如，范围是否相交，是否包含，地理位置中的点面相交，或者按点搜索附近的点，当然，它能实现的功能还不仅于此。

GiST索引不是一种单独的索引类型，是一种架构，可以在该架构上实现不同的索引类型。

除了支持大于小于等于外还支持，如地理数据、图像等。空间类型：方位 上下左右 空间关系 空间距离等。

### Gist索引的优点

- 适用 范围类型、几何索引、模糊搜索
- 支持任意数据类型的索引，包括标准的数据类型、自定义的数据类型和复合数据类型等
- 支持丰富的操作符，包括相等、不相等、小于、大于、范围查询、全文搜索等；
- 支持多态的设计，可以适应不同类型的数据和索引操作符；
- 支持高效的范围查询和全文搜索，可以提高查询性能。

### Gist索引的缺点

- 排序和过滤不能同时使用

### Gist索引的应用场景

- 点（和其他几何实体）和邻近搜索。
- 区间和排除约束
- 全文搜索